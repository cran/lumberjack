<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

<title>Installation</title>

<script type="text/javascript">
window.onload = function() {
  var imgs = document.getElementsByTagName('img'), i, img;
  for (i = 0; i < imgs.length; i++) {
    img = imgs[i];
    // center an image if it is the only element of its parent
    if (img.parentElement.childElementCount === 1)
      img.parentElement.style.textAlign = 'center';
  }
};
</script>

<!-- Styles for R syntax highlighter -->
<style type="text/css">
   pre .operator,
   pre .paren {
     color: rgb(104, 118, 135)
   }

   pre .literal {
     color: #990073
   }

   pre .number {
     color: #099;
   }

   pre .comment {
     color: #998;
     font-style: italic
   }

   pre .keyword {
     color: #900;
     font-weight: bold
   }

   pre .identifier {
     color: rgb(0, 0, 0);
   }

   pre .string {
     color: #d14;
   }
</style>

<!-- R syntax highlighter -->
<script type="text/javascript">
var hljs=new function(){function m(p){return p.replace(/&/gm,"&amp;").replace(/</gm,"&lt;")}function f(r,q,p){return RegExp(q,"m"+(r.cI?"i":"")+(p?"g":""))}function b(r){for(var p=0;p<r.childNodes.length;p++){var q=r.childNodes[p];if(q.nodeName=="CODE"){return q}if(!(q.nodeType==3&&q.nodeValue.match(/\s+/))){break}}}function h(t,s){var p="";for(var r=0;r<t.childNodes.length;r++){if(t.childNodes[r].nodeType==3){var q=t.childNodes[r].nodeValue;if(s){q=q.replace(/\n/g,"")}p+=q}else{if(t.childNodes[r].nodeName=="BR"){p+="\n"}else{p+=h(t.childNodes[r])}}}if(/MSIE [678]/.test(navigator.userAgent)){p=p.replace(/\r/g,"\n")}return p}function a(s){var r=s.className.split(/\s+/);r=r.concat(s.parentNode.className.split(/\s+/));for(var q=0;q<r.length;q++){var p=r[q].replace(/^language-/,"");if(e[p]){return p}}}function c(q){var p=[];(function(s,t){for(var r=0;r<s.childNodes.length;r++){if(s.childNodes[r].nodeType==3){t+=s.childNodes[r].nodeValue.length}else{if(s.childNodes[r].nodeName=="BR"){t+=1}else{if(s.childNodes[r].nodeType==1){p.push({event:"start",offset:t,node:s.childNodes[r]});t=arguments.callee(s.childNodes[r],t);p.push({event:"stop",offset:t,node:s.childNodes[r]})}}}}return t})(q,0);return p}function k(y,w,x){var q=0;var z="";var s=[];function u(){if(y.length&&w.length){if(y[0].offset!=w[0].offset){return(y[0].offset<w[0].offset)?y:w}else{return w[0].event=="start"?y:w}}else{return y.length?y:w}}function t(D){var A="<"+D.nodeName.toLowerCase();for(var B=0;B<D.attributes.length;B++){var C=D.attributes[B];A+=" "+C.nodeName.toLowerCase();if(C.value!==undefined&&C.value!==false&&C.value!==null){A+='="'+m(C.value)+'"'}}return A+">"}while(y.length||w.length){var v=u().splice(0,1)[0];z+=m(x.substr(q,v.offset-q));q=v.offset;if(v.event=="start"){z+=t(v.node);s.push(v.node)}else{if(v.event=="stop"){var p,r=s.length;do{r--;p=s[r];z+=("</"+p.nodeName.toLowerCase()+">")}while(p!=v.node);s.splice(r,1);while(r<s.length){z+=t(s[r]);r++}}}}return z+m(x.substr(q))}function j(){function q(x,y,v){if(x.compiled){return}var u;var s=[];if(x.k){x.lR=f(y,x.l||hljs.IR,true);for(var w in x.k){if(!x.k.hasOwnProperty(w)){continue}if(x.k[w] instanceof Object){u=x.k[w]}else{u=x.k;w="keyword"}for(var r in u){if(!u.hasOwnProperty(r)){continue}x.k[r]=[w,u[r]];s.push(r)}}}if(!v){if(x.bWK){x.b="\\b("+s.join("|")+")\\s"}x.bR=f(y,x.b?x.b:"\\B|\\b");if(!x.e&&!x.eW){x.e="\\B|\\b"}if(x.e){x.eR=f(y,x.e)}}if(x.i){x.iR=f(y,x.i)}if(x.r===undefined){x.r=1}if(!x.c){x.c=[]}x.compiled=true;for(var t=0;t<x.c.length;t++){if(x.c[t]=="self"){x.c[t]=x}q(x.c[t],y,false)}if(x.starts){q(x.starts,y,false)}}for(var p in e){if(!e.hasOwnProperty(p)){continue}q(e[p].dM,e[p],true)}}function d(B,C){if(!j.called){j();j.called=true}function q(r,M){for(var L=0;L<M.c.length;L++){if((M.c[L].bR.exec(r)||[null])[0]==r){return M.c[L]}}}function v(L,r){if(D[L].e&&D[L].eR.test(r)){return 1}if(D[L].eW){var M=v(L-1,r);return M?M+1:0}return 0}function w(r,L){return L.i&&L.iR.test(r)}function K(N,O){var M=[];for(var L=0;L<N.c.length;L++){M.push(N.c[L].b)}var r=D.length-1;do{if(D[r].e){M.push(D[r].e)}r--}while(D[r+1].eW);if(N.i){M.push(N.i)}return f(O,M.join("|"),true)}function p(M,L){var N=D[D.length-1];if(!N.t){N.t=K(N,E)}N.t.lastIndex=L;var r=N.t.exec(M);return r?[M.substr(L,r.index-L),r[0],false]:[M.substr(L),"",true]}function z(N,r){var L=E.cI?r[0].toLowerCase():r[0];var M=N.k[L];if(M&&M instanceof Array){return M}return false}function F(L,P){L=m(L);if(!P.k){return L}var r="";var O=0;P.lR.lastIndex=0;var M=P.lR.exec(L);while(M){r+=L.substr(O,M.index-O);var N=z(P,M);if(N){x+=N[1];r+='<span class="'+N[0]+'">'+M[0]+"</span>"}else{r+=M[0]}O=P.lR.lastIndex;M=P.lR.exec(L)}return r+L.substr(O,L.length-O)}function J(L,M){if(M.sL&&e[M.sL]){var r=d(M.sL,L);x+=r.keyword_count;return r.value}else{return F(L,M)}}function I(M,r){var L=M.cN?'<span class="'+M.cN+'">':"";if(M.rB){y+=L;M.buffer=""}else{if(M.eB){y+=m(r)+L;M.buffer=""}else{y+=L;M.buffer=r}}D.push(M);A+=M.r}function G(N,M,Q){var R=D[D.length-1];if(Q){y+=J(R.buffer+N,R);return false}var P=q(M,R);if(P){y+=J(R.buffer+N,R);I(P,M);return P.rB}var L=v(D.length-1,M);if(L){var O=R.cN?"</span>":"";if(R.rE){y+=J(R.buffer+N,R)+O}else{if(R.eE){y+=J(R.buffer+N,R)+O+m(M)}else{y+=J(R.buffer+N+M,R)+O}}while(L>1){O=D[D.length-2].cN?"</span>":"";y+=O;L--;D.length--}var r=D[D.length-1];D.length--;D[D.length-1].buffer="";if(r.starts){I(r.starts,"")}return R.rE}if(w(M,R)){throw"Illegal"}}var E=e[B];var D=[E.dM];var A=0;var x=0;var y="";try{var s,u=0;E.dM.buffer="";do{s=p(C,u);var t=G(s[0],s[1],s[2]);u+=s[0].length;if(!t){u+=s[1].length}}while(!s[2]);if(D.length>1){throw"Illegal"}return{r:A,keyword_count:x,value:y}}catch(H){if(H=="Illegal"){return{r:0,keyword_count:0,value:m(C)}}else{throw H}}}function g(t){var p={keyword_count:0,r:0,value:m(t)};var r=p;for(var q in e){if(!e.hasOwnProperty(q)){continue}var s=d(q,t);s.language=q;if(s.keyword_count+s.r>r.keyword_count+r.r){r=s}if(s.keyword_count+s.r>p.keyword_count+p.r){r=p;p=s}}if(r.language){p.second_best=r}return p}function i(r,q,p){if(q){r=r.replace(/^((<[^>]+>|\t)+)/gm,function(t,w,v,u){return w.replace(/\t/g,q)})}if(p){r=r.replace(/\n/g,"<br>")}return r}function n(t,w,r){var x=h(t,r);var v=a(t);var y,s;if(v){y=d(v,x)}else{return}var q=c(t);if(q.length){s=document.createElement("pre");s.innerHTML=y.value;y.value=k(q,c(s),x)}y.value=i(y.value,w,r);var u=t.className;if(!u.match("(\\s|^)(language-)?"+v+"(\\s|$)")){u=u?(u+" "+v):v}if(/MSIE [678]/.test(navigator.userAgent)&&t.tagName=="CODE"&&t.parentNode.tagName=="PRE"){s=t.parentNode;var p=document.createElement("div");p.innerHTML="<pre><code>"+y.value+"</code></pre>";t=p.firstChild.firstChild;p.firstChild.cN=s.cN;s.parentNode.replaceChild(p.firstChild,s)}else{t.innerHTML=y.value}t.className=u;t.result={language:v,kw:y.keyword_count,re:y.r};if(y.second_best){t.second_best={language:y.second_best.language,kw:y.second_best.keyword_count,re:y.second_best.r}}}function o(){if(o.called){return}o.called=true;var r=document.getElementsByTagName("pre");for(var p=0;p<r.length;p++){var q=b(r[p]);if(q){n(q,hljs.tabReplace)}}}function l(){if(window.addEventListener){window.addEventListener("DOMContentLoaded",o,false);window.addEventListener("load",o,false)}else{if(window.attachEvent){window.attachEvent("onload",o)}else{window.onload=o}}}var e={};this.LANGUAGES=e;this.highlight=d;this.highlightAuto=g;this.fixMarkup=i;this.highlightBlock=n;this.initHighlighting=o;this.initHighlightingOnLoad=l;this.IR="[a-zA-Z][a-zA-Z0-9_]*";this.UIR="[a-zA-Z_][a-zA-Z0-9_]*";this.NR="\\b\\d+(\\.\\d+)?";this.CNR="\\b(0[xX][a-fA-F0-9]+|(\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)";this.BNR="\\b(0b[01]+)";this.RSR="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|\\.|-|-=|/|/=|:|;|<|<<|<<=|<=|=|==|===|>|>=|>>|>>=|>>>|>>>=|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~";this.ER="(?![\\s\\S])";this.BE={b:"\\\\.",r:0};this.ASM={cN:"string",b:"'",e:"'",i:"\\n",c:[this.BE],r:0};this.QSM={cN:"string",b:'"',e:'"',i:"\\n",c:[this.BE],r:0};this.CLCM={cN:"comment",b:"//",e:"$"};this.CBLCLM={cN:"comment",b:"/\\*",e:"\\*/"};this.HCM={cN:"comment",b:"#",e:"$"};this.NM={cN:"number",b:this.NR,r:0};this.CNM={cN:"number",b:this.CNR,r:0};this.BNM={cN:"number",b:this.BNR,r:0};this.inherit=function(r,s){var p={};for(var q in r){p[q]=r[q]}if(s){for(var q in s){p[q]=s[q]}}return p}}();hljs.LANGUAGES.cpp=function(){var a={keyword:{"false":1,"int":1,"float":1,"while":1,"private":1,"char":1,"catch":1,"export":1,virtual:1,operator:2,sizeof:2,dynamic_cast:2,typedef:2,const_cast:2,"const":1,struct:1,"for":1,static_cast:2,union:1,namespace:1,unsigned:1,"long":1,"throw":1,"volatile":2,"static":1,"protected":1,bool:1,template:1,mutable:1,"if":1,"public":1,friend:2,"do":1,"return":1,"goto":1,auto:1,"void":2,"enum":1,"else":1,"break":1,"new":1,extern:1,using:1,"true":1,"class":1,asm:1,"case":1,typeid:1,"short":1,reinterpret_cast:2,"default":1,"double":1,register:1,explicit:1,signed:1,typename:1,"try":1,"this":1,"switch":1,"continue":1,wchar_t:1,inline:1,"delete":1,alignof:1,char16_t:1,char32_t:1,constexpr:1,decltype:1,noexcept:1,nullptr:1,static_assert:1,thread_local:1,restrict:1,_Bool:1,complex:1},built_in:{std:1,string:1,cin:1,cout:1,cerr:1,clog:1,stringstream:1,istringstream:1,ostringstream:1,auto_ptr:1,deque:1,list:1,queue:1,stack:1,vector:1,map:1,set:1,bitset:1,multiset:1,multimap:1,unordered_set:1,unordered_map:1,unordered_multiset:1,unordered_multimap:1,array:1,shared_ptr:1}};return{dM:{k:a,i:"</",c:[hljs.CLCM,hljs.CBLCLM,hljs.QSM,{cN:"string",b:"'\\\\?.",e:"'",i:"."},{cN:"number",b:"\\b(\\d+(\\.\\d*)?|\\.\\d+)(u|U|l|L|ul|UL|f|F)"},hljs.CNM,{cN:"preprocessor",b:"#",e:"$"},{cN:"stl_container",b:"\\b(deque|list|queue|stack|vector|map|set|bitset|multiset|multimap|unordered_map|unordered_set|unordered_multiset|unordered_multimap|array)\\s*<",e:">",k:a,r:10,c:["self"]}]}}}();hljs.LANGUAGES.r={dM:{c:[hljs.HCM,{cN:"number",b:"\\b0[xX][0-9a-fA-F]+[Li]?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+(?:[eE][+\\-]?\\d*)?L\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+\\.(?!\\d)(?:i\\b)?",e:hljs.IMMEDIATE_RE,r:1},{cN:"number",b:"\\b\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\.\\d+(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"keyword",b:"(?:tryCatch|library|setGeneric|setGroupGeneric)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\.",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\d+(?![\\w.])",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\b(?:function)",e:hljs.IMMEDIATE_RE,r:2},{cN:"keyword",b:"(?:if|in|break|next|repeat|else|for|return|switch|while|try|stop|warning|require|attach|detach|source|setMethod|setClass)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"literal",b:"(?:NA|NA_integer_|NA_real_|NA_character_|NA_complex_)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"literal",b:"(?:NULL|TRUE|FALSE|T|F|Inf|NaN)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"identifier",b:"[a-zA-Z.][a-zA-Z0-9._]*\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"<\\-(?!\\s*\\d)",e:hljs.IMMEDIATE_RE,r:2},{cN:"operator",b:"\\->|<\\-",e:hljs.IMMEDIATE_RE,r:1},{cN:"operator",b:"%%|~",e:hljs.IMMEDIATE_RE},{cN:"operator",b:">=|<=|==|!=|\\|\\||&&|=|\\+|\\-|\\*|/|\\^|>|<|!|&|\\||\\$|:",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"%",e:"%",i:"\\n",r:1},{cN:"identifier",b:"`",e:"`",r:0},{cN:"string",b:'"',e:'"',c:[hljs.BE],r:0},{cN:"string",b:"'",e:"'",c:[hljs.BE],r:0},{cN:"paren",b:"[[({\\])}]",e:hljs.IMMEDIATE_RE,r:0}]}};
hljs.initHighlightingOnLoad();
</script>



<style type="text/css">
body, td {
   font-family: sans-serif;
   background-color: white;
   font-size: 13px;
}

body {
  max-width: 800px;
  margin: auto;
  padding: 1em;
  line-height: 20px;
}

tt, code, pre {
   font-family: 'DejaVu Sans Mono', 'Droid Sans Mono', 'Lucida Console', Consolas, Monaco, monospace;
}

h1 {
   font-size:2.2em;
}

h2 {
   font-size:1.8em;
}

h3 {
   font-size:1.4em;
}

h4 {
   font-size:1.0em;
}

h5 {
   font-size:0.9em;
}

h6 {
   font-size:0.8em;
}

a:visited {
   color: rgb(50%, 0%, 50%);
}

pre, img {
  max-width: 100%;
}
pre {
  overflow-x: auto;
}
pre code {
   display: block; padding: 0.5em;
}

code {
  font-size: 92%;
  border: 1px solid #ccc;
}

code[class] {
  background-color: #F8F8F8;
}

table, td, th {
  border: none;
}

blockquote {
   color:#666666;
   margin:0;
   padding-left: 1em;
   border-left: 0.5em #EEE solid;
}

hr {
   height: 0px;
   border-bottom: none;
   border-top-width: thin;
   border-top-style: dotted;
   border-top-color: #999999;
}

@media print {
   * {
      background: transparent !important;
      color: black !important;
      filter:none !important;
      -ms-filter: none !important;
   }

   body {
      font-size:12pt;
      max-width:100%;
   }

   a, a:visited {
      text-decoration: underline;
   }

   hr {
      visibility: hidden;
      page-break-before: always;
   }

   pre, blockquote {
      padding-right: 1em;
      page-break-inside: avoid;
   }

   tr, img {
      page-break-inside: avoid;
   }

   img {
      max-width: 100% !important;
   }

   @page :left {
      margin: 15mm 20mm 15mm 10mm;
   }

   @page :right {
      margin: 15mm 10mm 15mm 20mm;
   }

   p, h2, h3 {
      orphans: 3; widows: 3;
   }

   h2, h3 {
      page-break-after: avoid;
   }
}
</style>



</head>

<body>
<p>This package allows you to monitor changes in data as they get processed. It
implements an easy-to-use and extensible logging framework, and comes with a few
data loggers implemented.</p>

<p>This vignette will show you how to get started and what the default loggers do. The <a href="extending.html">extending lumberjack</a> vignette explains how to build your own loggers.</p>

<h2>Installation</h2>

<p>Install the package with</p>

<pre><code class="r">install.packages(&quot;lumberjack&quot;)
</code></pre>

<h2>The lumberjack workflow</h2>

<p>So you want to know who does what to your data as it flows through your
process. Here&#39;s the workflow that allows you to do it using the <code>lumberjack</code>
package. (Note the use of <code>%L&gt;%</code>!)</p>

<pre><code class="r">out &lt;- women %L&gt;%
  start_log() %L&gt;%
  identity() %L&gt;%
  head() %L&gt;%
  dump_log()
</code></pre>

<pre><code>## Dumped a log at /tmp/RtmptwQqdO/Rbuild4d9023d66089/lumberjack/vignettes/simple_log.csv
</code></pre>

<pre><code class="r">read.csv(&quot;simple_log.csv&quot;)
</code></pre>

<pre><code>##   step                time expression changed
## 1    1 2018-07-20 10:01:00 identity()   FALSE
## 2    2 2018-07-20 10:01:00     head()    TRUE
</code></pre>

<p>Lets go through this step by step to see what happened. The start of the script 
defines an output variable <code>out</code> and passes <code>women</code> to the lumberjack (<code>%L&gt;%</code>).
Next, the function <code>start_log</code> makes sure that logging starts from there. We are
now ready to start performing logged transformations on our dataset. First, we 
apply the <code>identity</code> function, which does exactly nothing. Then, the <code>head</code> 
function selects the first six rows in of the dataset and <code>dump_log()</code>
writes the log to a csv file, which we then read in. After the log is dumped,
logging stops automatically (by default).</p>

<p>The logging data consists of a step number, a timestamp, the expression
evaluated to transform the data, and an indicator whether the data had changed
at all. As expected, the <code>identity</code> function hasn&#39;t changed anything and the
<code>head</code> function cuts of all records below the sixth row.</p>

<p>By the way, the variable <code>out</code> contains the first six records of the <code>women</code> dataset as
expected.</p>

<pre><code class="r">out
</code></pre>

<pre><code>##   height weight
## 1     58    115
## 2     59    117
## 3     60    120
## 4     61    123
## 5     62    126
## 6     63    129
</code></pre>

<p>You have now seen the most important functions of the package. Let&#39;s summarize them.</p>

<ul>
<li><code>start_log(data, log)</code>: start logging using possibly a custom logger (see next section)</li>
<li><code>%L&gt;%</code>: the lumberjack. a logging-aware function composition operator (&#39;pipe&#39;).</li>
<li><code>dump_log(data, stop, ...)</code>: dump the log for <code>data</code> (if present)</li>
<li><code>stop_log(data)</code>: stop logging.</li>
</ul>

<p>All these functions are data-in, data-out. You are probably used to this from 
using <a href="http://dplyr.tidyverse.org/">dplyr</a> or one of its siblings. However, the 
<code>lumberjack</code> functions are not limited to <code>data.frame</code>-like objects. In
principle, changes to any object type can be logged, but it depends on the
logger whether that will actually work &ndash; most will expect a particular data
structure.</p>

<h2>Changing the logger</h2>

<p>Just tell <code>start_log()</code> what logger to use. In the example below we use the
builtin <code>cellwise</code> logger. For this logger it is necessary to have a key column
that identifies the rows uniquely so we add that first (we use <code>within</code> here,
this is base R&#39;s equivalent to <code>dplyr</code>&#39;s <code>mutate</code>).</p>

<pre><code class="r">logfile &lt;- tempfile(fileext = &quot;.csv&quot;) # where the logging info is written
women$a_key &lt;- sprintf(&quot;W%02d&quot;, seq_len(nrow(women)))   # add a primary key to &#39;women&#39;

# make the small example ea bit smaller
wom &lt;- head(women,5)

out &lt;- wom %L&gt;%
  start_log( log = cellwise$new(key=&quot;a_key&quot;) ) %L&gt;%
  within(height &lt;- sqrt(height)) %L&gt;%
  within(weight &lt;- weight*2) %L&gt;%
  dump_log(file=logfile, stop=TRUE)
</code></pre>

<pre><code>## Dumped a log at /tmp/Rtmp2bTkcR/file4da7161af9bc.csv
</code></pre>

<pre><code class="r">read.csv(logfile)
</code></pre>

<pre><code>##    step                     time                     expression key
## 1     1 2018-07-20 10:01:00 CEST within(height &lt;- sqrt(height)) W01
## 2     1 2018-07-20 10:01:00 CEST within(height &lt;- sqrt(height)) W02
## 3     1 2018-07-20 10:01:00 CEST within(height &lt;- sqrt(height)) W03
## 4     1 2018-07-20 10:01:00 CEST within(height &lt;- sqrt(height)) W04
## 5     1 2018-07-20 10:01:00 CEST within(height &lt;- sqrt(height)) W05
## 6     2 2018-07-20 10:01:00 CEST   within(weight &lt;- weight * 2) W01
## 7     2 2018-07-20 10:01:00 CEST   within(weight &lt;- weight * 2) W02
## 8     2 2018-07-20 10:01:00 CEST   within(weight &lt;- weight * 2) W03
## 9     2 2018-07-20 10:01:00 CEST   within(weight &lt;- weight * 2) W04
## 10    2 2018-07-20 10:01:00 CEST   within(weight &lt;- weight * 2) W05
##    variable old        new
## 1    height  58   7.615773
## 2    height  59   7.681146
## 3    height  60   7.745967
## 4    height  61   7.810250
## 5    height  62   7.874008
## 6    weight 115 230.000000
## 7    weight 117 234.000000
## 8    weight 120 240.000000
## 9    weight 123 246.000000
## 10   weight 126 252.000000
</code></pre>

<h2>Available loggers</h2>

<p>Here&#39;s a short overview of known loggers.</p>

<h3>In the lumberjack package</h3>

<ul>
<li><code>simple</code> Just check whether data has changed.</li>
<li><code>cellwise</code> Track changes per cell (incl. old value, new value)</li>
<li><code>filedump</code> Dump a file after each step (including the zeroth step.)</li>
<li><code>expression_logger</code> Track the result of any expression</li>
</ul>

<h3>In other packages</h3>

<ul>
<li><code>validate::lbj_rules</code> Track changes in data quality measured by validation rules (<a href="https://CRAN.R-project.org/package=validate">validate</a> version &gt;= 0.2.0).</li>
<li><code>validate::lbj_cells</code> Track changes in cell filling and cell counts (<a href="https://CRAN.R-project.org/package=validate">validate</a> version &gt;=0.2.0 ).</li>
<li><code>daff::lbj_daff</code> Use data-diff to track changes in data frame-like objects. (<a href="https://CRAN.R-project.org/package=daff">daff</a> version &gt;= 3.3)</li>
</ul>

<p>See the <a href="extending.html">extending lumberjack</a> vignette on how to build your own loggers.</p>

<h2>One more example: the expression logger</h2>

<p>The expression logger allows you to log the result of one or more expressions that will
be evaluated after each data processing step. For example, suppose we want to follow the 
mean and variance of variables in the <code>women</code> dataset as it gets processed.</p>

<pre><code class="r">logger &lt;- expression_logger$new(mnh = mean(height), sdh = sd(height))
out &lt;- women %L&gt;%
  start_log(logger) %L&gt;%
  transform(height &lt;- height*2.54) %L&gt;% # height in cm
  transform(weight &lt;- weight*0.453592) %L&gt;%
  dump_log()
</code></pre>

<pre><code>## Dumped a log at expression_log.csv
</code></pre>

<pre><code class="r">read.csv(&quot;expression_log.csv&quot;,stringsAsFactors = FALSE)
</code></pre>

<pre><code>##   step                             expression mnh      sdh
## 1    1     transform(height &lt;- height * 2.54)  65 4.472136
## 2    2 transform(weight &lt;- weight * 0.453592)  65 4.472136
</code></pre>

<h2>Changing logger behaviour</h2>

<p>There are two ways to change how a logger behaves. By setting options
at initialization and by setting options when dumping a log.</p>

<h3>Setting options for the logger</h3>

<p>The <code>start_log</code> function adds a logging object as an attribute to its input 
data. By default, this is the <code>simple</code> logger, which only checks whether data 
has changed at all. The behavior of this logger can be changed by 
passing options when it is created. To see this, have a look at the complete
call, as it is executed by default.</p>

<pre><code class="r">dat &lt;- start_log(women, log = simple$new())
</code></pre>

<p>The expression <code>simple$new()</code> creates a new logging object, and <code>start_log</code>
makes sure it is attached as an attribute to the copy of the <code>women</code> dataset
stored in <code>dat</code>. The simple logger has one option called <code>verbose</code>, that can be set when calling <code>$new</code>. The default is <code>TRUE</code>, here we set it to <code>FALSE</code>.</p>

<pre><code class="r">dat &lt;- start_log(women, log=simple$new(verbose=FALSE))
</code></pre>

<p>The effect is that no message is printed when the log is dumped to file.</p>

<pre><code class="r">out &lt;- dat %L&gt;% identity() %L&gt;% dump_log()
read.csv(&quot;simple_log.csv&quot;)
</code></pre>

<pre><code>##   step                time expression changed
## 1    1 2018-07-20 10:01:01 identity()   FALSE
</code></pre>

<p>Note that the available options depend logger you use. Look at the logger&#39;s 
helpfile (<code>?simple</code>, <code>?cellwise</code>) to see all options.</p>

<h3>Setting options for the output</h3>

<p>For the simple logger, the default output file is <code>simple_log.csv</code> This can be
changed when calling <code>dump_log</code>. </p>

<pre><code class="r">out &lt;- dat %L&gt;% 
  start_log() %L&gt;% 
  identity() %L&gt;% 
  dump_log(file=&quot;log_all_day.csv&quot;)
</code></pre>

<pre><code>## Dumped a log at /tmp/RtmptwQqdO/Rbuild4d9023d66089/lumberjack/vignettes/log_all_day.csv
</code></pre>

<pre><code class="r">read.csv(&quot;log_all_day.csv&quot;)
</code></pre>

<pre><code>##   step                time expression changed
## 1    1 2018-07-20 10:01:01 identity()   FALSE
</code></pre>

<p>The function <code>dump_log</code> passes most of its arguments to the logger&#39;s <code>$dump()</code>
method. See the help file of the logger for the options (<code>?simple</code>, <code>?cellwise</code>).</p>

<h3>Options for other loggers</h3>

<p>Loggers can come in different forms. In principle, authors are free to use R6
classes (as is done here), Reference classes, or anything else that follows the
lumberjack API. This means that the way that logging objects are initialized may
vary from logger to logger. Check the documentation of a logger to see how to
operate it. Maintainers of packages that offer loggers that work with the
lumberjack are kindly requested to list the <code>lumberjack</code> in the <code>Enhances</code> field
of the <code>DESCRIPTION</code> file, so they can be found through <code>lumberjack</code>&#39;s CRAN page.</p>

<h2>Properties of the lumberjack</h2>

<p>There are several function composition (&#39;pipe&#39;) operators in the R community, 
including <a href="https://cran.r-project.org/package=magrittr">magrittr</a>, 
<a href="https://cran.r-project.org/package=pipeR">pipeR</a> and 
<a href="https://github.com/piccolbo/yapo">yapo</a>. All have different behavior. </p>

<p>The  lumberjack operator behaves as a simplified version of the <code>magrittr</code> pipe
operator. Here are some examples.</p>

<pre><code class="r"># pass the first argument to a function
1:3 %L&gt;% mean()

# pass arguments using &quot;.&quot;
TRUE %L&gt;% mean(c(1,NA,3), na.rm = .)

# pass arguments to an expression, using &quot;.&quot;
1:3 %L&gt;% { 3 * .}

# in a more complicated expression, return &quot;.&quot; explicitly
women %L&gt;% { .$height &lt;- 2*.$height; . }
</code></pre>

<p>The main differences with <code>magrittr</code> are that </p>

<ul>
<li>there is no assignment-pipe like <code>%&lt;&gt;%</code>.</li>
<li>it does not allow you to define functions in the magrittr style: <code>a &lt;- . %&gt;% sin(.)</code></li>
<li>you cannot do things like <code>pi %&gt;% sin</code> and expect an answer</li>
</ul>

<h2>Logging changes on non-data.frame objects</h2>

<p>This is possible, but the logger has to support it. The <code>simple</code> logger works
for any object, but the <code>cellwise</code> logger works on data.frame-like objects only.</p>

<pre><code class="r">out &lt;- 1:3 %L&gt;% 
  start_log() %L&gt;%
  {.*2} %L&gt;%
  dump_log(file=&quot;foo.csv&quot;)
</code></pre>

<pre><code>## Dumped a log at /tmp/RtmptwQqdO/Rbuild4d9023d66089/lumberjack/vignettes/foo.csv
</code></pre>

<pre><code class="r">print(out)
</code></pre>

<pre><code>## [1] 2 4 6
</code></pre>

<pre><code class="r">read.csv(&quot;foo.csv&quot;)
</code></pre>

<pre><code>##   step                time      expression changed
## 1    1 2018-07-20 10:01:01 {\n    . * 2\n}    TRUE
</code></pre>

</body>

</html>
